/*
 * AudioStreamer.c
 *
 *  Created on: Feb 19, 2018
 *      Author: ericksong
 */
#include "AudioStreamer.h"

static void txCallback(I2S_Type *base, sai_edma_handle_t *handle, status_t status, void *userData)
{
    sai_transfer_t xfer = {0};

    sendCount++;
    if (sendCount == beginCount)
    {
        istxFinished = true;
        SAI_TransferTerminateSendEDMA(base, handle);
        sendCount = 0;
    }
    else
    {
        if (!sdcard)
        {
            xfer.data = audioBuff + ((sendCount - 1U) % BUFFER_NUM) * BUFFER_SIZE;
            xfer.dataSize = BUFFER_SIZE;
            SAI_TransferSendEDMA(base, handle, &xfer);
        }
    }
}

static void rxCallback(I2S_Type *base, sai_edma_handle_t *handle, status_t status, void *userData)
{
    sai_transfer_t xfer = {0};

    receiveCount++;

    if (receiveCount == beginCount)
    {
        isrxFinished = true;
        SAI_TransferTerminateReceiveEDMA(base, handle);
        receiveCount = 0;
    }
    else
    {
        if (!sdcard)
        {
            xfer.data = audioBuff + ((receiveCount - 1U) % BUFFER_NUM) * BUFFER_SIZE;
            xfer.dataSize = BUFFER_SIZE;
            SAI_TransferReceiveEDMA(base, handle, &xfer);
        }
    }
}

void Init_Dialog7212(void){


}
